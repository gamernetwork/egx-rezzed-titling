<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>EGX Rezzed Developer Sessions</title>
	<script src="../../lib/jquery-3.1.1.min.js"></script>
	<script src="../../lib/TweenMax.min.js"></script>
	<style type="text/css">
		* { box-sizing: border-box; }
		body { margin: 0px; }
		main {
			width: 1920px; height: 1080px;
			position: relative;
			top: 0; left: 0;
			overflow: hidden;
		}
		.block {
			width: 3000px; height: 1080px;
			top: 0; left: 0;
			overflow: hidden;
			position: absolute;
		    -webkit-transform-origin: bottom left;
		}
		.block.dark-blue {
			background: #360c4e;
		    -webkit-transform: rotate(-45deg);
		}
		.block.blue {
			background: #503575;
		    -webkit-transform: rotate(-0deg);
		    left: 0; top: 0;
		}
		.block.pink {
			background: #ff57c0;
		    -webkit-transform: rotate(-41deg);
		}
		main > div {
			display: none;
		}
		h1, h2, h3, h4, h5, h6 { margin: 0px; }
		h1 {
			font-family: 'NB Grotesk', sans-serif;
			font-size: 120px; line-height: 100px;
			color: #ff57c0;
			text-transform: uppercase;
			/*letter-spacing: -.05em;*/
			max-width: 700px;
			margin-left: -7px;
		}
		h2, h4, h6 {
			font-family: 'NB Grotesk', sans-serif;
			font-size: 36px; line-height: 36px;
			color: white;
			text-transform: uppercase;
		}
		h3, h5 {
			font-family: Helvetica, sans-serif;
			font-size: 26px; line-height: 32px;
			font-weight: 300;
			color: white;
		}
		ul {
			list-style: none;
			margin: 0; padding: 0;
		}
		.corner {
			position: absolute;
			height: 100%;
			width: 100%;
			top: 0px; left: 0px;
			padding: 50px 75px;
		}
		.corner h3 {
			line-height: 26px;
		}
		.corner h2.countdown {
			color: white;
			text-transform: initial;
			font-size: 70px;
			line-height: 60px;
			margin-bottom: 3px;
		}
		/*.corner h2 {
			margin-bottom: 10px;
		}*/
		.logo {
			width: 379px;
			/*height: 231px;*/
		}
		.schedule {
			width: 1920px; height: 1080px;
			position: absolute;
			top: 0; left: 0;
		}
		.schedule-item {
			width: 600px; max-height: 700px;
			position: absolute;
			top: 340px;
			-webkit-transform-origin: center 350px;
			-webkit-transition: -webkit-transform 1s;
			color: white;
			background: #503575;
		}
		.schedule-item .image {
			width: 600px; height: 300px;
			background-position: center;
			background-size: cover;
			margin: 0 auto;
		}
		.schedule-item .headings {
			background: #360c4e;
			-webkit-transition: all .25s;
			padding: 30px;
			border-bottom: 3px solid #ff57c0;
		}
		.schedule-item span { color: #360c4e; }
		.schedule-item h6 {
			line-height: 40px;
			height: 50px;
			margin-left: 0;
			/*color: #ff57c0;*/
		}
		.schedule-item h4 {
			line-height: 40px;
			margin-bottom: 10px;
		}
		.schedule-item.small {
			-webkit-transform: scale(.65);
		}
		.schedule-item.small .headings {
			background: transparent;
			border-bottom: none;
		}
		.next-image	 {
			position: absolute;
			left: 0; top: 0;
			width: 1925px;
			height: 1080px;
			background-size: cover;
		}
		.next-image-wrapper {
			position: relative;
			margin-top: 0; margin-left: 0;
		}
		.next-image-outer {
			position: absolute;
			top: 0; left: 0;
			width: 1925px;
		}
		.next-text-wrapper {
			position: absolute;
			left: 0; bottom: 0;
			width: 1920px;
			background: #503575;
			-webkit-transform: translateY(0);
		}
		.next-text {
			display: block;
			margin: 0 auto;
			width: 100%;
			max-width: 1280px;
			padding: 50px;
			padding-left: 250px;
		}
		.next-time {
			color: #ff57c0;
		}
		.lower-left-third {
			width: 850px;
			position: absolute;
			bottom: 50px; left: 50px;
			overflow: hidden;
		}
		.next-text h2 {
			font-size: 40px; line-height: 40px;
		}
		h2.next-heading {
			margin-bottom: 5px;
		}
		.lower-left-third h2,
		.lower-left-third h3 {
			position: relative;
			left: 0;
			padding: 40px;;
		}
		.lower-left-third h2,
		.lower-right-third h4 {
			background: #360c4e;
			color: #ff57c0;
		}
		.lower-right-third h2,
		.lower-left-third h3 {
			background: #503575;
			color: white;
		}
		.lower-right-third {
			max-width: 1820px;
			position: absolute;
			bottom: 50px; right: 50px;
			text-align: right;
			overflow: hidden;
		}
		.lower-right-third h2,
		.lower-right-third h4 {
			padding: 40px;
			position: relative;
			bottom: 0; right: 0;
			display: inline-block;
		}
		.lower-right-third h2 {
			-webkit-transform: translateY(0);
		}
		.lower-right-third h4 {
			/*color: #ff57c0;*/
			/*background: #360c4e;*/
			-webkit-transform: translateY(0);
		}
	</style>
</head>
<body>

<main>
	<div class="lower-left-third">
		<h2>&nbsp;</h2>
		<h3>&nbsp;</h3>
	</div>

	<div class="lower-right-third">
		<h4>Up next</h4><h2>&nbsp;</h2>
	</div>

	<div class="background block blue"></div>

	<div class="schedule"></div>

	<div class="next-image-outer">
		<div class="next-image-wrapper block">
			<div class="next-image block"></div>
		</div>
	</div>

	<div class="next-text-wrapper">
		<div class="next-text">
			<h2 class="next-time">&nbsp;</h2>
			<h2 class="next-heading">&nbsp;</h2>
			<h3 class="next-subheading">&nbsp;</h3>
		</div>
	</div>

	<div class="overlay">
		<div class="block pink"></div>
		<div class="block dark-blue"></div>
	</div>

	<div class="corner">
		<img class="logo" src="img/EGX_REZZED_LS_WHITE.png" />
		<h1 class="heading"></h1>
		<h2 class="countdown"></h2>
		<ul>
			<li><h2>#EGX @EGX</h2></li>
			 <!-- @EGX</h2></li> -->
			<li><h3>facebook.com/egx</h3></li>
			<!-- <li><h3>youtube.com/egx</h3></li> -->
			<li><h3>egx.net</h3></li>
		</ul>
	</div>
</main>

<!-- <script src="../../schedule/schedule.js"></script> -->
<script type="text/javascript">

	var day = 'Friday',
		slot = 0,
		schedule_delay = 4000;

	$('main > div').show();

	// build timelines
	var timelines = {
		'overlay': animOverlay(),
		'background': animBackground(),
		'next_text': animNextText(),
		'next_image': animNextImage(),
		'lower_left': animLowerLeft(),
		'lower_right': animLowerRight(),
	};
	var sessions = [], schedule_timer = null, schedule_hold = false, is_intermission = false, countdown_timer = null;

	function loadSchedule(json) {
		$.getJSON(json, function(data) {
			console.log(data);
			sessions = data;
			// $.each(data, function(key, val) {});
		});
	}

	// testing
	loadSchedule('../../schedule/schedule.json');
	// upNext();
	// upNextImageOut()
	// schedule();
	// lowerLeft(11000);
	// lowerRight(6000);
	// image();
	// killAll();

	// slides
	function intermission() {
		schedule();
		// var items = $('.schedule-item').length;
		// console.log(items);
		is_intermission = true;
	}

	function upNext() {
		stopAllTimeouts();
		hideSchedule();
		showOverlay('Up next');
		startCountdown();
		showBackground();
		showNext();
	}

	function upNextOut(keep_background) {
		hideOverlay();
		hideNext();
		if (!keep_background) setTimeout(hideBackground, 950);
	}

	function upNextImageOut() {
		fadeBackgroundOut(true);
		hideNextImage();
	}

	function schedule(hold) {
		stopAllTimeouts();
		hideNextImage();
		hideNextText();
		stopCountdown();
		schedule_hold = hold;
		showOverlay('Coming up');
		showBackground();
		setSchedule();
		setTimeout(playSchedule, 1250);
	}

	function scheduleOut(keep_background) {
		clearInterval(schedule_timer);
		hideOverlay();
		hideSchedule();
		if (!keep_background) setTimeout(hideBackground, 950);
	}

	function lowerLeft(time) {
		hideLowerRight();
		if (!time) time = 11000;
		var slots = getSlots(slot, true);
		if (slots.length > 0) {
			var i = slots[0];
			showLowerLeft(sessions[i].heading, sessions[i].subHeading);
		}
		setTimeout(hideLowerLeft, time);
	}

	function lowerRight(time) {
		hideLowerLeft();
		if (!time) time = 6000;
		var slots = getSlots(slot + 1, true);
		if (slots.length > 0) {
			var i = slots[0];
			showLowerRight(sessions[i].timeStart, sessions[i].heading);
		}
		setTimeout(hideLowerRight, time);
	}

	function image() {
		timelines.overlay.seek( '-=0', false );
		var slots = getSlots(slot, true);
		if (slots.length > 0) {
			var i = slots[0];
			setNextImage(sessions[i].image);
			timelines.next_image.seek( '-=0', false );
		}
	}

	function killAll(keep_background) {
		stopAllTimeouts();
		schedule_hold = false;
		is_intermission = false;
		clearInterval(schedule_timer);
		hideOverlay();
		hideSchedule();
		hideNext();
		hideLowerLeft();
		hideLowerRight();
		if (!keep_background) setTimeout(hideBackground, 950);
	}

	// show / hide
	function showOverlay(text) {
		setHeading(text);
		timelines.overlay.play();
	}

	function hideOverlay(text) {
		timelines.overlay.reverse();
		stopCountdown();
	}

	function showBackground() {
		fadeBackgroundIn();
		timelines.background.play();
	}

	function hideBackground() {
		timelines.background.reverse();
	}

	function showNext() {
		var slots = getSlots(slot, true);
		if (slots.length > 0) {
			var i = slots[0];
			setNextText(sessions[i].heading, sessions[i].subHeading, sessions[i].timeStart, sessions[i].timeEnd);
			setNextImage(sessions[i].image);
			setTimeout(function() {
				timelines.next_image.play();
			}, 50);
			setTimeout(function() {
				timelines.next_text.play();
			}, 1500);
		}
	}

	function hideNext() {
		timelines.next_text.reverse();
		setTimeout(function() {
			timelines.next_image.reverse();
		}, 1000);
	}

	function hideNextImage() {
		timelines.next_image.reverse();
	}

	function hideNextText() {
		timelines.next_text.reverse();
	}

	function showLowerLeft(heading, subheading) {
		setLowerLeftText(heading, subheading);
		timelines.lower_left.play();
	}

	function hideLowerLeft() {
		timelines.lower_left.reverse();
	}

	function showLowerRight(time_start, heading) {
		setLowerRightText(time_start, heading);
		timelines.lower_right.play();
	}

	function hideLowerRight() {
		timelines.lower_right.reverse();
	}

	function playSchedule() {
		schedule_pos = 0;
		clearInterval(schedule_timer);
		var items = $('.schedule-item').length;
		if (items > 0) {
			advanceSchedule();
			schedule_timer = setInterval(function() { advanceSchedule(); }, schedule_delay);
		}
	}

	function endSchedule() {
		clearInterval(schedule_timer);
		if (!schedule_hold) {
			scheduleOut();
			setTimeout(hideBackground, 950);
			if (is_intermission) {
				is_intermission = false;
				setTimeout(upNext, 950);
			}
		}
	}

	var schedule_pos = 0;
	function advanceSchedule() {
		var positions = [1410, 996, 582, 50, -600];
		var time = 1, ease = 'Power2.easeInOut';

		var items = $('.schedule-item');
		schedule_pos ++;
		if (schedule_pos > items.length) { 
			endSchedule();
			return;
		}
		var timeline = makeTimeline();

		for (var i = 0; i < items.length; i++) {
			var item = $(items[i]);
			var pos = positions.length - 1 - schedule_pos + i;
			if (pos > positions.length - 1) pos = positions.length - 1;
			if (pos < 0) pos = 0;
			
			timeline
				.to(item, time, { css: {
					right: positions[pos] + 'px',
				}, ease: ease }, 0);

			if (pos == 0) {
				timeline
					.to(item, time, { css: {
						opacity: 0,
					}, ease: ease }, 0);				
			} else if (pos == 2) {
				shrinkScheduleItem(item);
			}
		}

		timeline.play();
	}

	function hideSchedule() {
		var items = $('.schedule-item');
		var timeline = makeTimeline();

		for (var i = 0; i < items.length; i++) {
			var item = $(items[i]);
			if (!item.hasClass('small')) shrinkScheduleItem(item);
		}

		timeline
			.staggerTo(items, .5, { css: {
				right: 1824 + 'px', opacity: 0,
			}, ease: Power2.easeIn }, 0.1);

		timeline.play();
	}

	// define anims
	function animOverlay() {
		var time = .75, ease = 'Power1.easeOut';
		var timeline = makeTimeline();
		timeline
			.from('.corner', time, { css: {
				top: '-540px', left: '-540px',
			}, ease: ease }, 0)
			.from('.block.dark-blue', time, { css: {
				top: '-540px', left: '-540px',
			}, ease: ease }, 0)
			.from('.block.pink', time, { css: {
				top: '-540px', left: '-540px',
			}, ease: ease }, 0)
			.from('.block.pink', time / 2, { css: {
				transform: 'rotate(-45deg)',
			}, ease: ease }, time / 2);
		return timeline;
	}

	function animBackground() {
		var timeline = makeTimeline();
		timeline
			.from('.background', .75, { css: {
				top: '-580px', left: '-580px',
			}, ease: Power1.easeInOut }, 0)
			.from('.background', 1, { css: {
				transform: 'rotate(-41deg)',
			}, ease: Power1.easeInOut }, .5);
		return timeline;
	}

	function animLowerLeft() {
		var timeline = makeTimeline();
		timeline
			.from('.lower-left-third h2', 1, { css: {
				left: '-100%',
			}, ease: Power3.easeInOut }, 0)
			.from('.lower-left-third h3', 1, { css: {
				left: '-100%',
			}, ease: Power2.easeInOut }, .1);
		return timeline;
	}

	function animLowerRight() {
		var timeline = makeTimeline();
		timeline
			.from('.lower-right-third h4', .75, { css: {
				opacity: 0,
			}, ease: Power3.easeInOut }, 0)
			.from('.lower-right-third h4', 1, { y: '201%', ease: Power4.easeInOut }, 0)
			.from('.lower-right-third h2', 1, { y: '101%', ease: Power4.easeInOut }, .2);
		return timeline;
	}

	function animNextImage() {
		var time = .75;
		var timeline = makeTimeline();
		timeline
			.from('.next-image-wrapper', time, { css: {
				top: '-580px', left: '-580px',
			}, ease: Power1.easeInOut }, 0)
			.from('.next-image-wrapper', time, { css: {
				transform: 'rotate(-41deg)',
			}, ease: Power1.easeInOut }, time)
			.from('.next-image', time, { css: {
				transform: 'rotate(41deg)',
			}, ease: Power1.easeInOut }, time);
		return timeline;
	}

	function animNextText() {
		var time = .75;
		var timeline = makeTimeline();
		timeline
			.from('.next-text-wrapper', 1, { y: '101%', ease: Power2.easeOut })
		return timeline;
	}

	// misc functions
	function makeTimeline() {
		var timeline = new TimelineMax();
		timeline.pause();
		return timeline;
	}

	function setHeading(text) { $('.heading').text(text); }

	function setCountdown(text) { $('.countdown').text(text).show(); }

	function setLowerLeftText(heading, subheading) {
		$('.lower-left-third h2').text(heading);
		$('.lower-left-third h3').text(subheading);
	}

	function setLowerRightText(time_start, heading) {
		$('.lower-right-third h2').text(time_start + ' ' + heading);
	}

	function setNextText(heading, subheading, time_start, time_end) {
		$('.next-heading').text(heading);
		$('.next-subheading').text(subheading);
		$('.next-time').text(time_start + ' - ' + time_end + ' BST');
	}

	function setNextImage(image) {
		$('.next-image').css({
			backgroundImage: 'url(' + image + ')',
			opacity: 1,
		});
	}

	function fadeNextImageOut(instant) {
		if (instant) $('.next-image').css({ opacity: 0, });
		else $('.next-image').animate({ opacity: 0, });
	}

	function fadeNextImageIn(instant) {
		if (instant) $('.next-image').css({ opacity: 1, });
		else $('.next-image').animate({ opacity: 1, });
	}

	function fadeBackgroundOut(instant) {
		if (instant) $('.background').css({ opacity: .5, });
		else $('.background').animate({ opacity: .5, });
	}

	function fadeBackgroundIn(instant) {
		if (instant) $('.background').css({ opacity: 1, });
		else $('.background').animate({ opacity: 1, });
	}

	function setSchedule() {
		clearSchedule();
		var slots = getSlots(slot);
		for (var i = 0; i < slots.length; i++) {
			var j = slots[i];
			addScheduleItem(sessions[j].heading, sessions[j].subHeading, sessions[j].timeStart, sessions[j].timeEnd, sessions[j].image, i);
		}
	}

	function clearSchedule() {
		$('.schedule').empty();
	}

	function addScheduleItem(heading, subheading, time_start, time_end, image, index) {
		// var time = '<h6>' + time_start + ' &mdash; ' + time_end + ' <span>BST</span>' + '</h6>';
		var time = '<h6>' + time_start + ' &mdash; ' + time_end + ' BST' + '</h6>';
		var image = '<div class="image" style="background-image: url(' + image + ');"></div>';
		var headings = '<div class="headings"><h4>' + heading + '</h4><h5>' + subheading + '</h5></div>';
		var item = $('<div class="schedule-item">' + time + image + headings + '</div>')
			.css({
				right: -600 + 'px',
			})
		$('.schedule').append(item);
	}

	function shrinkScheduleItem(item) {
		item.addClass('small');
		item.children('h6').animate({
			marginLeft: '30px',
		});
		item.children('.image').animate({
			width: '540px',
		});
	}

	function getSlots(n, first) {
		var index = 0 - n;
		var slots = [];
		for (var i = 0; i < sessions.length; i++) {
			if (sessions[i].day == day) {
				if (index >= 0) {
					slots.push(i);
					if (first) return slots;
				}
				index ++;
			}
		}
		return slots;
	}

	function stopAllTimeouts() {
		var id = window.setTimeout(null,0);
		while (id--) window.clearTimeout(id);
	}

	// time management
	function nextSlot() { slot ++; }
	function prevSlot() { slot --; }
	function setSlot(new_slot) { slot = new_slot; }
	function setDay(new_day) { day = new_day; }

	// countdown
	function startCountdown() {
		updateCountdown();
		countdown_timer = setInterval(function() {
			updateCountdown();
		}, 1000);
	}

	function updateCountdown() {
		setCountdown(getCountdown());
	}

	function stopCountdown() {
		clearInterval(countdown_timer);
		$('.countdown').hide();
	}

	function getCountdown() {
		var now = new Date();
		var countdown_date = new Date();
		var i = getSlots(slot, true);
		var time = sessions[i].timeStart.split(':');
		if (time.length == 2) {
			countdown_date.setHours(time[0]);
			countdown_date.setMinutes(time[1]);
			countdown_date.setSeconds(0);
			var distance = countdown_date - now;
			if (distance < 0) {
				clearInterval(countdown_timer);
				return 'STARTING SOON';
			}
			else {
				var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
				var seconds = Math.floor((distance % (1000 * 60)) / 1000);
				return (hours ? hours + 'h ' : '') + minutes + 'm ' + seconds + 's';
			}
		}
		else return '';
	}

	// CasparCG stuff
	function update(str) {
		// do nothing
	}
	function play() {
		// do nothing
	}
	function next() {
		// do nothing
	}

</script>
</body>
</html>